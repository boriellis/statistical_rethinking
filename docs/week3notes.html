<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>week3notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="week3notes_files/libs/clipboard/clipboard.min.js"></script>
<script src="week3notes_files/libs/quarto-html/quarto.js"></script>
<script src="week3notes_files/libs/quarto-html/popper.min.js"></script>
<script src="week3notes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="week3notes_files/libs/quarto-html/anchor.min.js"></script>
<link href="week3notes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="week3notes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="week3notes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="week3notes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="week3notes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">week3notes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="week-3-lecture-notes" class="level1">
<h1>Week 3 Lecture Notes</h1>
<section id="lecture-5---elemental-confounds" class="level2">
<h2 class="anchored" data-anchor-id="lecture-5---elemental-confounds">Lecture 5 - Elemental Confounds</h2>
<p><img src="images/Screenshot%202025-03-19%20at%2015.43.55.png" class="img-fluid"></p>
<p>We’re going to talk today about things that happen during the estimator that can cause issues with our estimate.</p>
<section id="assocation-causation" class="level4">
<h4 class="anchored" data-anchor-id="assocation-causation">Assocation &amp; Causation</h4>
<p>Statistical recipes must defend against confounding, which is a feature of the sample and how we use it that misleads us</p>
<p><img src="images/Screenshot%202025-03-19%20at%2015.45.23.png" class="img-fluid"></p>
</section>
<section id="the-fork" class="level3">
<h3 class="anchored" data-anchor-id="the-fork">The Fork</h3>
<p>Z is a common cause of X and Y: X &amp; Y are associated because they share the common cause Z. Once stratified by Z, there’s no association between X and Y - so, at each level of Z, X and Y are independent (not associated) with one another.</p>
<p><img src="images/Screenshot%202025-03-19%20at%2015.51.30.png" class="img-fluid" width="465"></p>
<p>in the above example, you can see that at z values of 0 or 1 X and Y aren’t correlated (correlation is out of 1, above 0.3 typically considered correlated)</p>
<p>so, example: why do regions of the USA with higher rates of marriage also have higher rates of divorce? Does marriage cause divorce?</p>
<p>estimand is causal effect of marriage on divorce</p>
<p><img src="images/Screenshot%202025-03-19%20at%2015.56.08.png" class="img-fluid" width="382"></p>
<p>(points of the scatter plot not showing up)</p>
<p><img src="images/Screenshot%202025-03-19%20at%2015.57.34.png" class="img-fluid" width="309"></p>
<p><img src="images/Screenshot%202025-03-19%20at%2015.59.54.png" class="img-fluid"></p>
<p>to stratify by A (age at marriage) include as term in linear model</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.01.10.png" class="img-fluid"></p>
<p>it is often conveneient to standardize by the mean in linear regression. standardizing means subtract mean and divide by standard deviation - it makes it easier to choose sensible prior and makes computation work better.</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.04.46.png" class="img-fluid"></p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.05.33.png" class="img-fluid" width="346"></p>
<p>The above code produces this ^ which is bad - they’re totally different, the slopes are too extreme,</p>
<p>better priors:</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.06.47.png" class="img-fluid"></p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.06.57.png" class="img-fluid" width="329"></p>
<p>I think this below is plotting the priors which can be useful?</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.15.07.png" class="img-fluid"></p>
<p>The slope is not the causal effect of M - that’s often reported but it’s not quite right. We’re going to do it the principled way which works when we get to more complex models. We do a simulation:</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.17.01.png" class="img-fluid"></p>
<p>we play god on M - we delete the arrows going into M to simulate the causal effect of M on D</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.18.56.png" class="img-fluid"></p>
<p>the guess from the above is that M on D is a lot smaller than A on D</p>
<p>but you still need to to estimate causal effect of A:</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.21.01.png" class="img-fluid" width="451"></p>
</section>
<section id="the-pipe" class="level3">
<h3 class="anchored" data-anchor-id="the-pipe">The Pipe</h3>
<p>there was also a Pipe in the above example. let’s look at that now.</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.26.14.png" class="img-fluid"></p>
<p>statistically the pipe and the fork look the same but causally they’re very different so we need to think about them differently. so if we stratified by Z there would be no association between Y and X again - because all the association is transmitted through the effect of X on Z</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.29.14.png" class="img-fluid"></p>
<p>EVERYTHING THAT Y KNOWS ABOUT X IS ALREADY KNOWN BY Z.</p>
<p>Example of a pipe:</p>
<p>sometimes ppl think if they’re doing a controlled experiment you don’t have to bother with all this confound stuff but that’s WRONG:</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.31.43.png" class="img-fluid" width="495"></p>
<p>Scientific Model:</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.32.26.png" class="img-fluid" width="283"></p>
<p>then we introduce our treatment: plant could be directly affected by the treatment (hurt or help) but for sure hopefully treatment will affect fungus.</p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.32.55.png" class="img-fluid" width="375"></p>
<p><img src="images/Screenshot%202025-03-19%20at%2016.33.53.png" class="img-fluid" width="413"></p>
<p>If we want to know the total causal effect of T on H, we DON’T want to stratify by F because we want the total causal effect here to know if we should use the treatment or not.</p>
<p>Sometimes you DO want to stratify by the mediator if you want to know the direct effect - that just isn’t the case here!</p>
<p>Another example: POST-TREATMENT BIAS</p>
<ul>
<li>if you stratify by the consequence of the treatment, you can induce post-treatment bias - mislead you that it doesn’t work, or that it does work. Rule of thumb: consequences of the treatment should not usually be included in the estimator. there are exceptions to this - things you measure during the experiment sometimes do need to be included.</li>
</ul>
<p>it can often be dangerous to stratify by</p>
</section>
<section id="the-collider" class="level3">
<h3 class="anchored" data-anchor-id="the-collider">The Collider</h3>
<p>The collider is where Z is jointly caused by both x and y. X and Y are NOT associated, they’re independent of one another - but bc they both influence Z, once stratified by Z, X and Y look VERY associated.</p>
<p><img src="images/Screenshot%202025-03-20%20at%2013.22.36.png" class="img-fluid"></p>
<p>the strong associations could read as causal, so there’s a risk of thinking something else is going on, like a fork.</p>
<p>they appear for a variety of reasons:</p>
<ul>
<li><p>some already arise from selection: suppose there are 200 research grant applications, scored both on newsworthiness and trustworthiness. let’s say they’re totally unrelated to one another. then we could think about the ones that are funded - if they’re sufficiently newsworthy and/or trustworthy they could both be funded. once you stratify by whether they’re funded or not there’s a strong association between trustworthiness and newsworthiness but in reality the two are not associated:</p>
<p><img src="images/Screenshot%202025-03-20%20at%2013.29.47.png" class="img-fluid"></p></li>
<li><p>points not showing on graph again</p></li>
</ul>
<p>other examples:</p>
<ul>
<li><p>restaurants survive by having good food or a good location - bad food in good locations</p></li>
<li><p>actors can succeed by being attractive or by being skilled - attractive actors are less skilled.</p></li>
</ul>
<p>endogenous colliders - colliders can also arise through your analysis via endogenous selection: if you stratify by a collider, it creates phantom non-causal associations.</p>
<ul>
<li><p>example: does age influence happiness? Possible confound here is marital status. suppose age has zero influence on happiness but that both age and happiness influence marital status (happier ppl more likely to get married) (older you are more likely you are to get married)</p></li>
<li><p><img src="images/Screenshot%202025-03-20%20at%2013.38.15.png" class="img-fluid"></p></li>
</ul>
</section>
<section id="the-descendent" class="level3">
<h3 class="anchored" data-anchor-id="the-descendent">The Descendent</h3>
<p>descendent is easy - it’s a parasite on the other three: how it behaves is dependent on what it’s attached to</p>
<p><img src="images/Screenshot%202025-03-20%20at%2013.41.37.png" class="img-fluid" width="479"></p>
<p>because Z is the parent of A, A holds information about Z - so if you stratified by A, it would reduce the measured association between X and Y. but A is actually not causally associated with X or Y</p>
<p>descendents are SUPER COMMON - many measurements are proxies of what we actually want to measure:</p>
<ul>
<li>factor analysis, measurement error, social networks - the things we’re measuring are not the thing we’re wanting to measure, but they contain information about the unobserved things.</li>
</ul>
<p>They’re both dangerous AND useful.</p>
</section>
</section>
<section id="lecture-6---good-bad-controls" class="level2">
<h2 class="anchored" data-anchor-id="lecture-6---good-bad-controls">Lecture 6 - Good &amp; Bad Controls</h2>
<p>Try to avoid being clever - that’s unreliable and opaque! we should instead be as boring as possible - reliant, transparent, logical procedures to derive implications that others can use to verify and challenge our work. We’re going to work on developing those tools more in this lecture.</p>
<p>We want a framework to take the confounds and do something with them. We think about a treatment X on a Y outcome and the issue of a common cause U that may or may not be measured but usually isn’t. Our best bet if we can is to randomize the treatment to remove its link with U - but that often doesn’t work, especially with observational studies. we also can attempt to randomize but it doesn’t always work all the way - there can still be a partial influence of U:</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.11.50.png" class="img-fluid"></p>
<p>Is there a statistical procedure that we can use to mimic randomization on X?</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.13.03.png" class="img-fluid" width="419"></p>
<p>we’re not going to learn this in a detailed mathematical way but this is useful for a lot of causal models so we wanna talk about it. So in a simple example with a simple confound, we can deal with the confound here by stratifying by U if we can measure it because it’s a fork:</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.14.43.png" class="img-fluid"></p>
<p>to look at the causal effect of X on Y, intervene on X to get “The distribution of Y, stratified by X and U, averaged over the distribution of U”</p>
<p>example:</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.20.05.png" class="img-fluid" width="390"></p>
<p>for DAGs, rules for finding P(Y|do(X)) are known s do-calculus (not calculus, just the calculations). do-calculus has two perspectives: it’s kind of the worst-case scenario, additional assumptions often allow stronger inference. do-calculus is also kind of a best case scenario - if inference is possible by do-calculus, it does not depend on special assumptions.</p>
<section id="backdoor-criterion" class="level3">
<h3 class="anchored" data-anchor-id="backdoor-criterion">Backdoor criterion</h3>
<p>The Backdoor criterion is a shortcut to apply some results of do-caculus. it’s a rule to find a set of variables to stratify by to yield P(Y|do(X))</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.23.58.png" class="img-fluid" width="280"></p>
<p>3 steps (with example in photos)</p>
<ol type="1">
<li><p>identify all paths connecting the treatment X to the outcome Y</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.25.16.png" class="img-fluid"></p></li>
<li><p>Paths with arrows ENTERING X are backdoor paths</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.26.13.png" class="img-fluid"></p></li>
<li><p>find the adjustment set that block or close all backdoor paths:</p></li>
</ol>
<p><img src="images/Screenshot%202025-03-26%20at%2016.26.52.png" class="img-fluid" width="405"></p>
<p>To simulate that confounded Y:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: cmdstanr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is cmdstanr version 0.8.1.9000</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStanR documentation and vignettes: mc-stan.org/cmdstanr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStan path: /Users/aspenellis/.cmdstan/cmdstan-2.36.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStan version: 2.36.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: posterior</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'posterior' was built under R version 4.4.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is posterior version 1.6.0.9000</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'posterior'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    mad, sd, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    %in%, match</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: parallel</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>rethinking (Version 2.42)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rethinking'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    rstudent</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>b_XY <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>b_UY <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>b_UZ <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>b_ZX <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="fu">rbern</span>(N)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,b_UZ<span class="sc">*</span>U)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,b_ZX<span class="sc">*</span>Z)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,b_XY<span class="sc">*</span>X<span class="sc">+</span>b_UY<span class="sc">*</span>U)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Y=</span>Y, <span class="at">X=</span>X, <span class="at">Z=</span>Z)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#now run linear regressions</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ignore U,Z</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>m_YX <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b_XY<span class="sc">*</span>X,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    b_XY <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span><span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">#stratify by Z</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>m_YXZ <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a <span class="sc">+</span> b_XY<span class="sc">*</span>X <span class="sc">+</span> b_Z<span class="sc">*</span>Z,</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(b_XY, b_Z) <span class="sc">~</span><span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span><span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_YX)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>post2 <span class="ot">&lt;-</span>  <span class="fu">extract.samples</span>(m_YXZ)</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(post<span class="sc">$</span>b_XY, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="dv">1</span>, <span class="at">xlab =</span> <span class="st">"posterior b_XY"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>))</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(post2<span class="sc">$</span>b_XY, <span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week3notes_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><img src="images/Screenshot%202025-03-26%20at%2016.41.26.png" class="img-fluid" width="467"></p>
<p>More complicated example of a backdoor criterion:</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.44.42.png" class="img-fluid"></p>
<p>we’re looking for a statistical to delete the arrows into X. you list all the paths connecting treatment X to outcome Y:</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.46.13.png" class="img-fluid"></p>
<p>you look at each of these paths and realize that you need to add Z, C, and or or B to the “adjustment set”</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.49.48.png" class="img-fluid"></p>
<p>you can use a tool to help you do this: www.daggitty.net</p>
<p>you can draw DAGs on your screen, then have it help you figure out the adjustment set.</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.52.06.png" class="img-fluid" width="445"></p>
<p>analyze this using the backdoor criterion:</p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.55.08.png" class="img-fluid" width="342"></p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.55.22.png" class="img-fluid" width="365"></p>
<p><img src="images/Screenshot%202025-03-26%20at%2016.54.42.png" class="img-fluid"></p>
<p>Summarizing backdoor criterion:</p>
<p>do-calc is more than backdoors and adjustment sets. full luzury Bayes uses all variables but in separate sub-models instead of single regression. do-calc is less demanding - finds relebant variables saves us having to make some assumptions, not always a regression.</p>
</section>
<section id="good-bad-controls" class="level3">
<h3 class="anchored" data-anchor-id="good-bad-controls">Good &amp; Bad Controls</h3>
<p>Control variable is a variable introduced to an analysis so that the causal estimate is possible. you can pick ones that ruin perfectly fine designs.</p>
<p>there are some common bad ways to pick em:</p>
<ul>
<li><p>don’t just add anything in the spreadsheet and see if it’s significant!! BAD!!!</p></li>
<li><p>don’t include any variables that are highly collinear - collinearity can arrive through a lot of different causal processes, you need to analyze that to know if it’s good to control for them</p></li>
<li><p>pick any pre-treatment measurement - also bad</p></li>
</ul>
<p>DON’T DO THAT!</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.01.41.png" class="img-fluid" width="468"></p>
<p>in the example above, the hobbies of two people influence their health but also might influence if they’re friends or not. if we do stratify by the fact that they’re friends we’re missing something about those unobserved variables (there’s colliders in there?)</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.03.15.png" class="img-fluid"></p>
<p>the backdoor paths are closed - if we stratify by Z, we open them, that’s then an issue:</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.03.45.png" class="img-fluid" width="497"></p>
<p>in this case we don’t stratify by Z!</p>
<p>another example:</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.04.35.png" class="img-fluid" width="522"></p>
<p>there are a bunch of things that affect both happiness and lifespan - those things are fine until you try to stratify by happiness - then they’re an issue!!</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.06.18.png" class="img-fluid"></p>
<p>if you add Z as a control you could TURN ON A CONFOUND!</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.11.43.png" class="img-fluid" width="462"></p>
<p>STATISTICAL SIGNIFICANCE IS NOT A JUSTIFICATION FOR MODEL STRUCTURE! YOU NEED A CAUSAL MODEL TO JUSTIFY YOUR RESULTS!</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.13.42.png" class="img-fluid"></p>
<p>another example:</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.14.43.png" class="img-fluid" width="357"></p>
<p>but colliders not always so easy to spot:</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.15.14.png" class="img-fluid"></p>
<p>ok when it comes to descendents:</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.16.50.png" class="img-fluid" width="386"></p>
<p>VERY BAD to add descendents as controls. selecting on the outcome is the most powerful way to ruin scientific inference</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.17.55.png" class="img-fluid" width="422"></p>
<p>don’t stratify by income because if you do there’s a narrower range of occupations and education and it will look like there isn’t as much of an effect</p>
<p>another example, now let’s look at a parent of X:</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.19.06.png" class="img-fluid"></p>
<p>there are no backdoors, but it’s still not good to condition on Z - if you stratify by Z there’s less variation in X and it will reduce the precision of my estimate of the effect of X on Y<img src="images/Screenshot%202025-03-28%20at%2010.21.16.png" class="img-fluid"></p>
<p>in the above it’s centered on the correct value but there’s a lot more uncertainty than if you did the correct model which is just y~x!</p>
<p>Now bias amplification example:</p>
<p>let’s add an unobserved counfound btwn x and y <img src="images/Screenshot%202025-03-28%20at%2010.22.40.png" class="img-fluid"></p>
<p>adding Z amplifies the bias?</p>
<p><img src="images/Screenshot%202025-03-28%20at%2010.23.36.png" class="img-fluid"></p>
<p>there’s already in the black model a bias away from the true value 0 - when you stratify by Z it amplifies it. to look at effect of X on Y you want to know where they both vary. within each level of Z there’s less variation in X, and there’s relatively more importance of the confound u in each level of Z</p>
</section>
</section>
</section>
<section id="week-3-reading-notes" class="level1">
<h1>Week 3 Reading Notes</h1>
<section id="chapter-5" class="level2">
<h2 class="anchored" data-anchor-id="chapter-5">Chapter 5</h2>
</section>
<section id="chapter-6" class="level2">
<h2 class="anchored" data-anchor-id="chapter-6">Chapter 6</h2>
</section>
</section>
<section id="homework" class="level1">
<h1>Homework</h1>
<p><img src="images/Screenshot%202025-04-03%20at%2016.16.57.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(foxes)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(foxes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group avgfood groupsize area weight
1     1    0.37         2 1.09   5.02
2     1    0.37         2 1.09   2.84
3     2    0.53         2 2.05   5.33
4     2    0.53         2 2.05   6.07
5     3    0.49         2 2.12   5.85
6     3    0.49         2 2.12   3.25</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>